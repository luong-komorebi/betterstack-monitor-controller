suite: serviceaccount
templates:
  - serviceaccount.yaml

tests:
  # ── default creation ─────────────────────────────────────────────────────────
  - it: renders a ServiceAccount by default
    asserts:
      - isKind:
          of: ServiceAccount
      - isAPIVersion:
          of: v1
      - hasDocuments:
          count: 1

  - it: ServiceAccount name matches fullname helper when no override
    asserts:
      - equal:
          path: metadata.name
          value: RELEASE-NAME-betterstack-monitor-controller

  - it: ServiceAccount is created in the release namespace
    asserts:
      - equal:
          path: metadata.namespace
          value: NAMESPACE

  # ── name override ────────────────────────────────────────────────────────────
  - it: uses serviceAccount.name override
    set:
      serviceAccount.name: custom-sa
    asserts:
      - equal:
          path: metadata.name
          value: custom-sa

  # ── disabled ──────────────────────────────────────────────────────────────────
  - it: does not render ServiceAccount when serviceAccount.create is false
    set:
      serviceAccount.create: false
    asserts:
      - hasDocuments:
          count: 0

  # ── annotations ──────────────────────────────────────────────────────────────
  - it: adds serviceAccount annotations (e.g. IRSA)
    set:
      serviceAccount.annotations:
        eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/my-role
    asserts:
      - equal:
          path: metadata.annotations["eks.amazonaws.com/role-arn"]
          value: arn:aws:iam::123456789012:role/my-role

  # ── standard labels ──────────────────────────────────────────────────────────
  - it: includes standard Helm labels
    asserts:
      - equal:
          path: metadata.labels["app.kubernetes.io/managed-by"]
          value: Helm
      - isNotEmpty:
          path: metadata.labels["helm.sh/chart"]
